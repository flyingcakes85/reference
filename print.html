<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Reference</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
                <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="fuse-create-filesystems.html"><strong aria-hidden="true">1.</strong> Using FUSE to create filesystems (Talk)</a></li><li class="chapter-item expanded "><a href="packaging/packaging-guide.html"><strong aria-hidden="true">2.</strong> A Guide to Packaging (Talk)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="packaging/what-is-packaging.html"><strong aria-hidden="true">2.1.</strong> What is packaging and package manager?</a></li><li class="chapter-item expanded "><a href="packaging/what-exactly-is-in-a-package.html"><strong aria-hidden="true">2.2.</strong> What exactly is in a package?</a></li><li class="chapter-item expanded "><a href="packaging/look-inside-arch-linux-package.html"><strong aria-hidden="true">2.3.</strong> Lets look inside an Arch Linux package</a></li><li class="chapter-item expanded "><a href="packaging/packaging-on-arch.html"><strong aria-hidden="true">2.4.</strong> Packaging on Arch Linux</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Reference</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>This is the place where I dump technical content until my main <a href="https://snehit.dev/posts">blog</a> gets revamped. (it'll never be revamped)</p>
<p>I tried a <a href="https://redesign.snehit.dev">redesign</a> but its nowhere close to even acceptable.</p>
<p>So for the time being, I'll use this mdbook to organize my stuff.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-fuse-to-create-filesystems-talk"><a class="header" href="#using-fuse-to-create-filesystems-talk">Using FUSE to create filesystems (Talk)</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="a-quickie-guide-to-packaging"><a class="header" href="#a-quickie-guide-to-packaging">A Quickie Guide to Packaging</a></h1>
<p>This is the reference chapter for my talk about packaging. I've put main focus on Arch Linux, but its is <em>only</em> an example. The core concepts apply to <em>ALL</em> packaging systems; not just on Linux distributions, but even on macOS (<a href="https://brew.sh/">Homebrew</a>) and Windows (<a href="https://chocolatey.org/">Chocolatey</a>)</p>
<ul>
<li><a href="packaging/./what-is-packaging.html">What is packaging?</a></li>
<li><a href="packaging/./what-exactly-is-in-a-package.html">What exactly is in a package?</a></li>
<li><a href="packaging/./look-inside-arch-linux-package.html">Lets look inside an Arch Linux package</a></li>
<li><a href="packaging/./packaging-on-arch.html">Packaging on Arch Linux</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-is-packaging-and-package-manager"><a class="header" href="#what-is-packaging-and-package-manager">What is packaging and package manager?</a></h1>
<p>Packaging is the process of bundling a software along with the needed extra files (icons, desktop files, configurations etc) needed to install/run it on a user's computer.</p>
<p>Pretty dense, right?</p>
<h2 id="is-this-related-to-installers"><a class="header" href="#is-this-related-to-installers">Is this related to installers?</a></h2>
<p>Yes and no!</p>
<p>Installers bundle the software AND and extra tool which copies the software components at the right locations, sets up configurations, ensures the dependencies are fulfilled and of late, even downloading the software itself. Each software brings its own installer.</p>
<p>With packages however, the archive that is downloaded contains ONLY the software. Extracting and copying it to your system locations is done by a <em>package manager</em>.</p>
<h2 id="why-shoud-i-use-a-package-manager-when-installer-can-do-everything"><a class="header" href="#why-shoud-i-use-a-package-manager-when-installer-can-do-everything">Why shoud I use a package manager when installer can do everything?</a></h2>
<p>So an installer can do everything? Right?</p>
<p><img src="packaging/./static/installers-can-do-everything.jpg" alt="installers can do everything" /></p>
<p>Thats what you don't want. Its conveniently easy to download a malicious installer from the internet and let it run with administrator privileges on your system, wrecking havoc.</p>
<p>A package manager on the other hand is a trusted software which often (but not always!) comes bundled with your operating system. The externally downloaded software (i.e. packages) are never &quot;run&quot; with superuser privileges. It is the package manager which does all the dirty work.</p>
<h2 id="is-there-anything-else-a-package-manager-does-or-is-that-all"><a class="header" href="#is-there-anything-else-a-package-manager-does-or-is-that-all">Is there anything else a package manager does, or is that all?</a></h2>
<p>Much more!</p>
<ul>
<li>package managers usually have a list of &quot;sources&quot; from where they will download the relevant package
<ul>
<li>so the chances of user doing to a shady website and downloading malware instead of the actual application is greatly reduced</li>
</ul>
</li>
<li>package managers <em>often</em> include a way to check integrity of downloaded packages
<ul>
<li>this safeguards you from mirror highjacking, MITM or simply damaged packages</li>
</ul>
</li>
<li>package managers can compute the dependency chain, meaning the user does not need to manually install all the pre-requisite libraries for an application</li>
<li>in the same vein, package managers can find out orphan packages (i.e. libraries which no software is using); this is helpful for system cleanup</li>
<li>they <em>may</em> also support rollbacks/snapshots
<ul>
<li><code>eopkg</code> on Solus natively supports rolling back package operations</li>
</ul>
</li>
</ul>
<h2 id="how-do-package-managers-install-a-software"><a class="header" href="#how-do-package-managers-install-a-software">How do package managers &quot;install&quot; a software?</a></h2>
<p>The common procedure is to use a package archive and extract it to the relevant system directory. As said before, installers on Windows bundle the logic to copy the files. With package managers however, the work of extracting and copying lies on the package manager.</p>
<p>The package archive contains files organized in proper directories, along with some metadata. We'll see this in depth in further sections. For a very basic package manager, these files need to be extracted to the system directories. However, a lot many times, there must be some post extraction steps that need to be performed. For example, upon upgrading the kernel, initramfs needs to be regenerated. The package manager takes care of these tasks.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-exactly-is-in-a-package"><a class="header" href="#what-exactly-is-in-a-package">What exactly is in a package?</a></h1>
<p>Continuing from last section, <em>what exactly is in a package</em>?</p>
<p>Package contains a compiled version of the software itself along with some necessities. So the next question is...</p>
<h2 id="what-goes-around-a-software-anyway"><a class="header" href="#what-goes-around-a-software-anyway">...What goes around a &quot;software&quot; anyway?</a></h2>
<p>Honestly, I wish the answer were simple. I can compile down my C code into a single binary and <em>that</em> pretty much is the software.</p>
<p>But real world ain't that straightforward yet.</p>
<p>Say, your software makes API calls over the internet. It will need an http library, right? Do you start writing your own http library? Nope. You make a web search for http libraries for C language and end up at the iconic <a href="https://curl.se/libcurl/">LibCurl</a> website. What now? Do you bundle LibCurl along with your software itself?</p>
<p>Well, you can. And thats called static linking. But often, you don't.</p>
<p>What you do is to dynamically link to the library (in our example, <code>libcurl.so</code>) and then expect it to be there on user's system during runtine. No need to include it with your application.</p>
<p>But hey, <em>who</em> ensures that <code>libcurl.so</code> will exist on user's system. Thats where the package manager says hi! It will see that <code>curl</code> is a dependency of your application and automatically pull it in when a user installs your application.</p>
<p>These are called <strong>dependencies</strong>. These are just the list of other packages which are required for your software to run.</p>
<p>The major block (dependencies) aside, what else goes into a package?</p>
<ul>
<li><strong>manual pages</strong> are an aboslute must for most CLI utilities</li>
<li>similarly, <strong>desktop files</strong> are important for GUI applications to show up in app launchers</li>
<li>if an icon is showing up in the app launcher, it must need an <strong>app icon</strong></li>
<li>application must have some <strong>configurations</strong>, right?</li>
<li>if it runs as a service, then <strong>service files</strong> are necessary</li>
<li>for CLI applications, often <strong>shell completions</strong> need to be bundled</li>
<li><strong>scripts</strong>
<ul>
<li>pre install</li>
<li>post install</li>
<li>pre remove</li>
<li>post remove</li>
</ul>
</li>
</ul>
<p>Depending on the packaging format, the components might be more or less, but the idea remains same:</p>
<p>\[
\text{Package} = \text{Software} + \text{Necessary components}
\]</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lets-look-inside-an-arch-linux-package"><a class="header" href="#lets-look-inside-an-arch-linux-package">Lets look inside an Arch Linux package</a></h1>
<p>For the purpose of this demonstration, I'm going to be showing contents of 2 packages:</p>
<ul>
<li>first, we see <strong>mdbook</strong>, which is the tool I'm using to build this reference website
<ul>
<li>I've chosen it, beacuse the package for mdbook is very simple</li>
</ul>
</li>
<li>second is <strong>btop</strong>, a system resource monitor
<ul>
<li>I've chosen this to show what extra items a GUI application usually bundles</li>
</ul>
</li>
</ul>
<h2 id="tldr"><a class="header" href="#tldr">tl;dr</a></h2>
<p>The purpose of this page is to show that a package contains files necessary for the software to work, placed nicely in relevant directories. Along with these files, package has some metadata files, which are required by package manager.</p>
<p>If you can appreciate these two facts, then you may skip this page.</p>
<h2 id="look-inside-mdbook"><a class="header" href="#look-inside-mdbook">Look inside: mdbook</a></h2>
<h3 id="download-the-package"><a class="header" href="#download-the-package">Download the package</a></h3>
<p>I'm downloading <strong>mdbook</strong> version 0.4.43, the latest as of composing this document. Depending on when you're reading, this version could be outdated or even removed from mirrors. You'll always find the latest version here: <a href="https://archlinux.org/packages/extra/x86_64/mdbook/download/">https://archlinux.org/packages/extra/x86_64/mdbook/download/</a></p>
<pre><code class="language-sh">cd /tmp
wget https://london.mirror.pkgbuild.com/extra/os/x86_64/mdbook-0.4.43-1-x86_64.pkg.tar.zst
</code></pre>
<h3 id="extracting-the-package"><a class="header" href="#extracting-the-package">Extracting the package</a></h3>
<pre><code class="language-sh">mkdir mdbook
tar -C mdbook -xf mdbook-0.4.43-1-x86_64.pkg.tar.zst
</code></pre>
<p>At this point, you can see the contents of folder <code>mdbook</code></p>
<pre><code class="language-sh">cd mdbook
ls -alh mdbook
</code></pre>
<p>It should give the following output</p>
<pre><code>lain@wired /tmp/mdbook
$ ls -alh
total 16K
drwxr-xr-x  3 lain lain  120 Dec 12 15:27 .
drwxrwxrwt 19 root root  560 Dec 12 15:26 ..
-rw-r--r--  1 lain lain 5.3K Nov 26 01:30 .BUILDINFO
-rw-r--r--  1 lain lain  597 Nov 26 01:30 .MTREE
-rw-r--r--  1 lain lain  409 Nov 26 01:30 .PKGINFO
drwxr-xr-x  4 lain lain   80 Nov 26 01:30 usr
</code></pre>
<p>Those familier with <a href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs/index.html">Filesystem Hierarchy Standard</a> will already recognize the <code>usr</code> folder. We'll come to that later.</p>
<h3 id="exploring-the-package"><a class="header" href="#exploring-the-package">Exploring the package</a></h3>
<p>Lets first explore the <code>usr</code> folder.</p>
<pre><code>lain@wired /tmp/mdbook
$ tree usr
usr
├── bin
│   └── mdbook
└── share
    ├── bash-completion
    │   └── completions
    │       └── mdbook
    ├── doc
    │   └── mdbook
    │       └── README.md
    ├── fish
    │   └── vendor_completions.d
    │       └── mdbook.fish
    └── zsh
        └── site-functions
            └── _mdbook
</code></pre>
<p>Normally, you'd find more folders under <code>/usr</code> on your system, but since this package needs to place files in only two of them (<code>bin</code> and <code>share</code>), it has only those two folders.</p>
<h4 id="the-main-binary"><a class="header" href="#the-main-binary">The main binary</a></h4>
<p>Under <code>usr/bin</code> we can see the binary, which is our software itself.</p>
<pre><code>lain@wired /tmp/mdbook
$ file usr/bin/mdbook
usr/bin/mdbook: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=7f0d0368fa7949be803463b0b426fb8655febfb6, for GNU/Linux 4.4.0, stripped
</code></pre>
<p>Explaining this output is beyond the scope of this reference. All you need to be convinced of as of now is that the file I just discussed is actually a binary, because <code>file</code> reports it to be of ELF format.</p>
<h4 id="documentation"><a class="header" href="#documentation">Documentation</a></h4>
<p>Under <code>usr/share/doc/mdbook</code> you see a bundled <code>README.md</code> file which has a basic starting point to using <code>mdbook</code>.</p>
<p>Documentations need not be markdown files. HTML files as documentation are very common too. Note that these are different from manpages, which are supposed to be stored in <code>/usr/share/man</code>.</p>
<h4 id="shell-completions"><a class="header" href="#shell-completions">Shell completions</a></h4>
<p>Finally, we're left with 3 folders</p>
<ul>
<li><code>usr/share/bash-completion</code></li>
<li><code>usr/share/zsh</code></li>
<li><code>usr/share/fish</code></li>
</ul>
<p>These folders bundle shell completions for <code>bash</code>, <code>zsh</code> and <code>fish</code> respectively. These are not necessary to be bundled, but nice to have nonetheless.</p>
<h3 id="metadata-files"><a class="header" href="#metadata-files">Metadata files</a></h3>
<p>We see 3 files not discussed yet: <code>.BUILDINFO</code>, <code>.MTREE</code> and <code>.PKGINFO</code>. These are metadata files, which aren't directly required by the software itself, but are needed nonetheless for installing and managing the package.</p>
<h4 id="mtree"><a class="header" href="#mtree">.MTREE</a></h4>
<p>This file contains hashes and timestamps of all files which are in the package. This is used by package manager to verify integrity of package.</p>
<p>Since its a compressed file, you can't directly <code>cat</code> it.</p>
<pre><code>lain@wired /tmp/mdbook
$ file .MTREE
.MTREE: gzip compressed data, from Unix, original size modulo 2^32 1584
</code></pre>
<p><code>file</code> reports it to be gzip compressed. Use <code>zcat</code> to print out contents.</p>
<pre><code>lain@wired /tmp/mdbook
$ zcat .MTREE
#mtree
/set type=file uid=0 gid=0 mode=644
./.BUILDINFO time=1732564809.0 size=5338 sha256digest=39d286ee40b577d2386b97104cb14b0ce01c98a42ae031300017202237f81872
./.PKGINFO time=1732564809.0 size=409 sha256digest=adc6a6de09619057285d9d76cbdb8ee9f3e99fd4e39ce41b0bdd924dbe1eab60
/set mode=755
./usr time=1732564809.0 type=dir
./usr/bin time=1732564809.0 type=dir
./usr/bin/mdbook time=1732564809.0 size=12027696 sha256digest=885ad1dd57886aea81f9d1b3fb0e56a4202a4a82b11481d4ea3259591dc4ac8f
./usr/share time=1732564809.0 type=dir
./usr/share/bash-completion time=1732564809.0 type=dir
./usr/share/bash-completion/completions time=1732564809.0 type=dir
./usr/share/bash-completion/completions/mdbook time=1732564809.0 mode=644 size=12922 sha256digest=4693cccac54ccf2c98f1ba4595a89028454c0222f568b7db1461ccc48ce7f868
./usr/share/doc time=1732564809.0 type=dir
./usr/share/doc/mdbook time=1732564809.0 type=dir
./usr/share/doc/mdbook/README.md time=1732564809.0 mode=644 size=1046 sha256digest=44e4086a85125c978b6c56be6beeb5d5b24c7394c96e281c1c589217eff4ca5f
./usr/share/fish time=1732564809.0 type=dir
./usr/share/fish/vendor_completions.d time=1732564809.0 type=dir
./usr/share/fish/vendor_completions.d/mdbook.fish time=1732564809.0 mode=644 size=7822 sha256digest=19374afc581279c2a31579171096e3fb03615b417431466c829e39a7a8d3b9cb
./usr/share/zsh time=1732564809.0 type=dir
./usr/share/zsh/site-functions time=1732564809.0 type=dir
./usr/share/zsh/site-functions/_mdbook time=1732564809.0 mode=644 size=10795 sha256digest=86db03752e01a5090041d67ff5b9824eaf59b02b93e2eb5bb7e00ef784bac13e
</code></pre>
<h4 id="buildinfo"><a class="header" href="#buildinfo">.BUILDINFO</a></h4>
<p>This file contains information about the build environment where this package was built. This is necessary for reproducible builds. It contains list of packages that existed in the build environment and specific build flags.</p>
<p>I am intentionally not copying the contents here, since the file is too long.</p>
<h4 id="pkginfo"><a class="header" href="#pkginfo">.PKGINFO</a></h4>
<p>This file contains metadata which the package manager needs to install/manage the package.</p>
<pre><code>lain@wired /tmp/mdbook
$ cat .PKGINFO
# Generated by makepkg 7.0.0
# using fakeroot version 1.36
pkgname = mdbook
pkgbase = mdbook
xdata = pkgtype=pkg
pkgver = 0.4.43-1
pkgdesc = Create book from markdown files, like Gitbook but implemented in Rust
url = https://github.com/rust-lang/mdBook
builddate = 1732564809
packager = Caleb Maclennan &lt;alerque@archlinux.org&gt;
size = 12060281
arch = x86_64
license = MPL2
depend = gcc-libs
makedepend = cargo
</code></pre>
<p>You'll notice this includes a key named <code>depends</code>. This is where the dependencies are listed and pacman knows which other packages need to be installed prior, in order for the current one to work. In this case, <code>mdbook</code> needs <code>gcc-libs</code> in order to work.</p>
<h4 id="more-metadata-files"><a class="header" href="#more-metadata-files">More metadata files</a></h4>
<p>The three metadata files we discussed are compulsory to be included with every package. However, there are two more files which are optionally included.</p>
<ul>
<li><code>.INSTALL</code>: this is used to bundle commands which need to be run after install, upgrade or removal of the package</li>
<li><code>.Changelog</code>: an optional file kept by package maintainer documenting changes of the package</li>
</ul>
<h3 id="libraries"><a class="header" href="#libraries">Libraries</a></h3>
<p>Since <code>mdbook</code> is written in Rust, it is <em>almost</em> a statically linked executable. All dependencies are statically linked (i.e. part of the binary itself) and the only library it links dynamically is GNU LibC. (and hence the external dependency on <code>gcc-libs</code> above) Had it bundled shared libraries, they would have been placed in <code>usr/lib</code>.</p>
<h2 id="look-inside-btop"><a class="header" href="#look-inside-btop">Look inside: btop</a></h2>
<p>Similar to the last section, lets get through this quick.</p>
<h3 id="download-and-extract"><a class="header" href="#download-and-extract">Download and extract</a></h3>
<p>The latest version of <code>btop</code> is always available at https://archlinux.org/packages/extra/x86_64/btop/download/</p>
<pre><code class="language-sh">cd /tmp
wget https://london.mirror.pkgbuild.com/extra/os/x86_64/btop-1.4.0-4-x86_64.pkg.tar.zst
mkdir btop
tar -C btop -xf btop-1.4.0-4-x86_64.pkg.tar.zst
</code></pre>
<h3 id="exploring-the-package-1"><a class="header" href="#exploring-the-package-1">Exploring the package</a></h3>
<p>The <code>usr</code> folder for <code>btop</code> looks like this</p>
<pre><code>lain@wired /tmp/btop
$ tree usr
usr
├── bin
│   └── btop
└── share
    ├── applications
    │   └── btop.desktop
    ├── btop
    │   ├── README.md
    │   └── themes
    │       ├── adapta.theme
    │       ├── adwaita.theme
    │       ├── ayu.theme
    │       ├── dracula.theme
    │       ├── dusklight.theme
    │       ├── elementarish.theme
    │       ├── everforest-dark-hard.theme
    │       ├── everforest-dark-medium.theme
    │       ├── flat-remix-light.theme
    │       ├── flat-remix.theme
    │       ├── greyscale.theme
    │       ├── gruvbox_dark.theme
    │       ├── gruvbox_dark_v2.theme
    │       ├── gruvbox_light.theme
    │       ├── gruvbox_material_dark.theme
    │       ├── horizon.theme
    │       ├── HotPurpleTrafficLight.theme
    │       ├── kyli0x.theme
    │       ├── matcha-dark-sea.theme
    │       ├── monokai.theme
    │       ├── night-owl.theme
    │       ├── nord.theme
    │       ├── onedark.theme
    │       ├── paper.theme
    │       ├── phoenix-night.theme
    │       ├── solarized_dark.theme
    │       ├── solarized_light.theme
    │       ├── tokyo-night.theme
    │       ├── tokyo-storm.theme
    │       ├── tomorrow-night.theme
    │       └── whiteout.theme
    ├── icons
    │   └── hicolor
    │       ├── 48x48
    │       │   └── apps
    │       │       └── btop.png
    │       └── scalable
    │           └── apps
    │               └── btop.svg
    └── man
        └── man1
            └── btop.1.gz
</code></pre>
<h4 id="binary"><a class="header" href="#binary">Binary</a></h4>
<p>The binary is again located inside <code>usr/bin</code>.</p>
<pre><code>lain@wired /tmp/btop
$ file usr/bin/btop
usr/bin/btop: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=112225f945ec5d5c28f69c1de22117f957a926f9, for GNU/Linux 4.4.0, stripped
</code></pre>
<p>We can run <code>ldd</code> to check which all libraries it is likned to.</p>
<pre><code>lain@wired /tmp/btop
$ ldd usr/bin/btop
	linux-vdso.so.1 (0x00007ffd9e7fd000)
	libstdc++.so.6 =&gt; /usr/lib/libstdc++.so.6 (0x000070b648c00000)
	libm.so.6 =&gt; /usr/lib/libm.so.6 (0x000070b648b11000)
	libgcc_s.so.1 =&gt; /usr/lib/libgcc_s.so.1 (0x000070b648ae3000)
	libc.so.6 =&gt; /usr/lib/libc.so.6 (0x000070b6488f2000)
	/lib64/ld-linux-x86-64.so.2 =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x000070b649026000)
</code></pre>
<h4 id="manpage"><a class="header" href="#manpage">Manpage</a></h4>
<p>Manpage for <code>btop</code> is in the Troff format. You can read the bundled manpage file using the <code>man</code> command.</p>
<pre><code class="language-sh">man usr/share/man/man1/btop.1.gz
</code></pre>
<h3 id="desktop-file-and-icons"><a class="header" href="#desktop-file-and-icons">Desktop file and icons</a></h3>
<p>You'll find a desktop file at <code>usr/share/applications/btop.desktop</code> which contains the desktop entry.</p>
<pre><code>lain@wired /tmp/btop
$ cat usr/share/applications/btop.desktop
[Desktop Entry]
Type=Application
Version=1.0
Name=btop++
GenericName=System Monitor
GenericName[it]=Monitor di sistema
Comment=Resource monitor that shows usage and stats for processor, memory, disks, network and processes
Comment[it]=Monitoraggio delle risorse: mostra utilizzo e statistiche per CPU, dischi, rete e processi
Icon=btop
Exec=btop
Terminal=true
Categories=System;Monitor;ConsoleOnly;
Keywords=system;process;task
</code></pre>
<p>The specific icon mentioned here is then searched for inside <code>/usr/share/icons</code>. The relevant icons are bundled in package at <code>usr/share/icons/hicolor/48x48/apps/btop.png</code> and <code>usr/share/icons/hicolor/scalable/apps/btop.svg</code>.</p>
<h3 id="btop-specific-themes"><a class="header" href="#btop-specific-themes">Btop specific themes</a></h3>
<p>Finally, <code>btop</code> also supports loading different theme definitions. The default set of bundled themes is placed inside a dedicated folder at <code>usr/share/btop/themes</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="packaging-on-arch-linux"><a class="header" href="#packaging-on-arch-linux">Packaging on Arch Linux</a></h1>
<p>The official wiki page (highly recommended to read) can be found here: <a href="https://wiki.archlinux.org/title/Creating_packages">Creating packages - Arch Wiki</a>. My page gives a brief overview of the process.</p>
<h2 id="package-build-process"><a class="header" href="#package-build-process">Package build process</a></h2>
<p>Packages on Arch Linux are built using <code>makepkg</code> tool. It takes a <code>PKGBUILD</code> as input and follows it to output a package archive.</p>
<p>The <code>PKGBUILD</code> is a recipe which lists ingredients (sources) and process (build steps) to build a package.</p>
<p><code>makepkg</code> looks at the sources and downloads them. It then computes hashes of downloaded sources with the checksums provided in <code>PKGBUILD</code>. Once the verification is complete, sources are extracted and built using the recipe provided. The said recipe must be executable in <code>bash</code>. Finally, upon successful build, the build outputs are archived along with the metadata into a package. This package is what the package manager (<code>pacman</code>) later extracts in order to &quot;install&quot; the software.</p>
<h2 id="pkgbuild"><a class="header" href="#pkgbuild">PKGBUILD</a></h2>
<p>Arch Linux provides a starting point with bundled protoype for a PKGBUILD.</p>
<pre><code>lain@wired ~
cat /usr/share/pacman/PKGBUILD.proto
# This is an example PKGBUILD file. Use this as a start to creating your own,
# and remove these comments. For more information, see 'man PKGBUILD'.
# NOTE: Please fill out the license field for your package! If it is unknown,
# then please put 'unknown'.

# Maintainer: Your Name &lt;youremail@domain.com&gt;
pkgname=NAME
pkgver=VERSION
pkgrel=1
epoch=
pkgdesc=&quot;&quot;
arch=()
url=&quot;&quot;
license=('GPL')
groups=()
depends=()
makedepends=()
checkdepends=()
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
changelog=
source=(&quot;$pkgname-$pkgver.tar.gz&quot;
        &quot;$pkgname-$pkgver.patch&quot;)
noextract=()
sha256sums=()
validpgpkeys=()

prepare() {
	cd &quot;$pkgname-$pkgver&quot;
	patch -p1 -i &quot;$srcdir/$pkgname-$pkgver.patch&quot;
}

build() {
	cd &quot;$pkgname-$pkgver&quot;
	./configure --prefix=/usr
	make
}

check() {
	cd &quot;$pkgname-$pkgver&quot;
	make -k check
}

package() {
	cd &quot;$pkgname-$pkgver&quot;
	make DESTDIR=&quot;$pkgdir/&quot; install
}
</code></pre>
<p>There are a lot of parameters, although, its not necessary to fill in all of them. You would fill in the file with relevant values. Refer an existing PKGBUILD (for example, <a href="https://aur.archlinux.org/cgit/aur.git/tree/PKGBUILD?h=maptool-bin"><code>maptool-bin</code></a>) to see what values should go in.</p>
<h2 id="pkgbuild-functions"><a class="header" href="#pkgbuild-functions">PKGBUILD functions</a></h2>
<h3 id="prepare"><a class="header" href="#prepare"><code>prepare()</code></a></h3>
<p>Steps to prepare sources for building should go here. Normally, this normally includes patches and distribution specific changes.</p>
<h3 id="pkgver"><a class="header" href="#pkgver"><code>pkgver()</code></a></h3>
<p>This step fetches package version. While package version is usually defined in the variable outside, the version for VCS sources needs to be fetched via shell commands that go in this function.</p>
<h3 id="build"><a class="header" href="#build"><code>build()</code></a></h3>
<p>Here comes the actual build step. A very simple <code>build()</code> function can look like this:</p>
<pre><code class="language-sh">build() {
    ./configure --prefix=/usr
    make DESTDIR=&quot;$pkgdir/&quot; install
}
</code></pre>
<p>This is source specific and packager needs to know if there are any build systems needed and what pre build steps need to be ensured. For example, build dependencies must be fetched before building.</p>
<h3 id="check"><a class="header" href="#check"><code>check()</code></a></h3>
<p>The test suite invocation goes here. Classically, this could be as simple as:</p>
<pre><code class="language-sh">check() {
    make check
}
</code></pre>
<p>However, modern test suites are more sophisticated and this function needs to be adapted accordingly.</p>
<h3 id="package"><a class="header" href="#package"><code>package()</code></a></h3>
<p>This is the final step, which is also compulsory for all packages to include. Here, the built files are copied into <code>$pkgdir</code> to ensure they're copied into the final package archive.</p>
<h2 id="sample-pkgbuild"><a class="header" href="#sample-pkgbuild">Sample PKGBUILD</a></h2>
<p>Lets build a simple PKGBUILD for a hello world application. The source for our application is going to be a GitHub repository, sepcifically <a href="https://github.com/memsharded/hello">memsharded/hello</a>.</p>
<p>Filling up the PKGBUILD variables, it should look like this:</p>
<pre><code class="language-bash">pkgname=hello-git
_pkgname=hello
pkgver=0.0.1
pkgrel=1
pkgdesc='A hello world application'
url='https://github.com/memsharded/hello'
source=(&quot;git+https://github.com/memsharded/hello&quot;)
arch=('x86_64')
licence=('MIT')
makedepends=('cmake')
sha256sums=(SKIP)
</code></pre>
<p>We have skipped checksum, because when we're using git as the source, git is doing its own checksum and ensuring integrity.</p>
<p>This application doesn't need any pre-build steps, so we can skip that. The application has a git source, so we do need <code>pkgver()</code> function to generate a version. In our case, we will use the short commit hash as the version.</p>
<pre><code class="language-bash">pkgver() {
    cd &quot;$srcdir/$_pkgname&quot;
    git log --oneline | head -n 1 | cut -d' ' -f1
}
</code></pre>
<p>Lets move to writing the <code>build()</code> function.</p>
<p>The source has provided <code>CMakeLists.txt</code> file, which is a clear indication that its using <a href="https://cmake.org/">CMake</a>. So, lets put the relevant CMake build step in here:</p>
<pre><code class="language-bash">build() {
    cmake -DCMAKE_INSTALL_PREFIX:PATH=/usr hello
    make
}
</code></pre>
<p>By now, we've built the binary from source. Finally, we must copy over binary to <code>$pkgdir</code> so that it ends up in package archive. This is done inside <code>package()</code> function.</p>
<pre><code class="language-bash">package() {
    install -Dm755 &quot;$srcdir/hello/bin/greet&quot; &quot;$pkgdir/usr/bin/greet&quot;
}
</code></pre>
<p>The final <code>PKGBUILD</code> should look like this:</p>
<pre><code class="language-bash">pkgname=hello-git
_pkgname=hello
pkgver=a707ee9
pkgrel=1
pkgdesc='A hello world application'
url='https://github.com/memsharded/hello'
source=(&quot;git+https://github.com/memsharded/hello&quot;)
arch=('x86_64')
licence=('MIT')
makedepends=('cmake')
sha256sums=(SKIP)

pkgver() {
    cd &quot;$srcdir/$_pkgname&quot;
    git log --oneline | head -n 1 | cut -d' ' -f1
}

build() {
    cmake -DCMAKE_INSTALL_PREFIX:PATH=/usr hello
    make
}

package() {
    install -Dm755 &quot;$srcdir/hello/bin/greet&quot; &quot;$pkgdir/usr/bin/greet&quot;
}
</code></pre>
<h2 id="building-from-pkgbuild"><a class="header" href="#building-from-pkgbuild">Building from PKGBUILD</a></h2>
<p>As mentioned before, the tool to build from <code>PKGBUILD</code> is <code>makepkg</code>.</p>
<p>Lets build the <code>PKGBUILD</code>. Change into the directory which has <code>PKGBUILD</code> and run:</p>
<pre><code class="language-sh">makepkg -s
</code></pre>
<p>This will fetch source, build and package it. Sample output is shown below</p>
<pre><code>==&gt; Making package: hello-git 0.0.1-1 (Sat 14 Dec 2024 04:01:21 PM IST)
==&gt; Checking runtime dependencies...
==&gt; Checking buildtime dependencies...
==&gt; Retrieving sources...
  -&gt; Updating hello git repo...
==&gt; Validating source files with sha256sums...
    hello ... Skipped
==&gt; Extracting sources...
  -&gt; Creating working copy of hello git repo...
Reset branch 'makepkg'
==&gt; Starting pkgver()...
==&gt; Updated version: hello-git a707ee9-1
==&gt; Removing existing $pkgdir/ directory...
==&gt; Starting build()...
CMake Warning (dev) at CMakeLists.txt:1 (PROJECT):
  cmake_minimum_required() should be called prior to this top-level project()
  call.  Please see the cmake-commands(7) manual for usage documentation of
  both commands.
This warning is for project developers.  Use -Wno-dev to suppress it.

CMake Deprecation Warning at CMakeLists.txt:2 (cmake_minimum_required):
  Compatibility with CMake &lt; 3.10 will be removed from a future version of
  CMake.

  Update the VERSION argument &lt;min&gt; value.  Or, use the &lt;min&gt;...&lt;max&gt; syntax
  to tell CMake that the project requires at least &lt;min&gt; but has been updated
  to work with policies introduced by &lt;max&gt; or earlier.


-- Configuring done (0.0s)
-- Generating done (0.0s)
-- Build files have been written to: /mnt/hd1/home/lain/.cache/aur/hello-git/src
[ 50%] Built target hello
[100%] Built target greet
==&gt; Entering fakeroot environment...
==&gt; Starting package()...
==&gt; Tidying install...
  -&gt; Removing libtool files...
  -&gt; Purging unwanted files...
  -&gt; Removing static library files...
  -&gt; Stripping unneeded symbols from binaries and libraries...
  -&gt; Compressing man and info pages...
==&gt; Checking for packaging issues...
==&gt; Creating package &quot;hello-git&quot;...
  -&gt; Generating .PKGINFO file...
  -&gt; Generating .BUILDINFO file...
  -&gt; Generating .MTREE file...
  -&gt; Compressing package...
==&gt; Leaving fakeroot environment.
==&gt; Finished making: hello-git a707ee9-1 (Sat 14 Dec 2024 04:01:23 PM IST)
</code></pre>
<p>Your working directory should have a file named <code>hello-git-a707ee9-1-x86_64.pkg.tar</code>. This is the built package.</p>
<p>A summary of useful flags for makepkg:</p>
<ul>
<li><code>-c, --clean</code>: clean up leftover files after successful build</li>
<li><code>-e, --noextract</code>: this will force <code>makepkg</code> to not extract source files or run <code>prepare()</code>. Useful when manually making changes in <code>$srcdir</code> to test.</li>
<li><code>-f, --force</code>: rebuild the package even if its already built</li>
<li><code>--skipchecksums</code>: do not verify checksum of source files</li>
<li><code>-i, --install</code>: install package after successful build</li>
<li><code>-s, --sycdeps</code>: install missing build/run dependencies</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
                
    </body>
</html>
